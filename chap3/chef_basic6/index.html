
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's Chef&Ansible Automation 技术与实战教程">
      
      
        <meta name="author" content="Jacob Xi">
      
      
      
        <link rel="prev" href="../chef_basic5/">
      
      
        <link rel="next" href="../../chap4/1ansible_intro/">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.5">
    
    
      
        <title>第二节 Creating LAMP Chef Cookbook Analysis - Jacob Chef&Ansible Automation Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-lamp-chef-cookbook-analysis" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob Chef&amp;Ansible Automation Book" class="md-header__button md-logo" aria-label="Jacob Chef&Ansible Automation Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob Chef&Ansible Automation Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第二节 Creating LAMP Chef Cookbook Analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxchefbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxchefbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob Chef&amp;Ansible Automation Book" class="md-nav__button md-logo" aria-label="Jacob Chef&Ansible Automation Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Jacob Chef&Ansible Automation Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxchefbook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxchefbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learning Chef
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Learning Chef
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Chef 介绍和安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Ruby和Chef语法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 如何写 Chef 配方 & chef-apply
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 用Test Kitchen管理沙盒测试环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 用 Chef 户端管理节点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 撰写和使用菜谱
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial7_attributes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 Chef 属性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 Chef 服务器同时管理多个节点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节 社区以及Chef-Client菜谱
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial10_zero/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十节 Chef zero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial11_databag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十一节 数概包Databag
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十二节 角色
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial13_env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十三节 环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial14_test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十四节 测试
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial15_term/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十五节 词汇表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/chef_tutorial16_int/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十六节 Chef Tutorial Interview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Chef Opt & Adv
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Chef Opt & Adv
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_adv4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Chef Roles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_adv5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Cookbook Versioning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_adv1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 How to Perform Chef Knife SSL Check and Fetch to Verify Certificate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_adv2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 12 Chef Knife Cookbook Command Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_op1_kinfe_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 knife search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/chef_adv3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 Chef Quick CheatSheet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Chef Cookbook Sample LAMP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Chef Cookbook Sample LAMP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../chef_basic5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Creating My First Chef Cookbook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    第二节 Creating LAMP Chef Cookbook Analysis
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    第二节 Creating LAMP Chef Cookbook Analysis
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1add-new-client-node" class="md-nav__link">
    1、Add new Client Node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2create-the-cookbook-on-workstation" class="md-nav__link">
    2、Create the Cookbook on workstation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3default-recipes" class="md-nav__link">
    3、default recipes
  </a>
  
    <nav class="md-nav" aria-label="3、default recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-defaultrb" class="md-nav__link">
    3-1 default.rb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-execute" class="md-nav__link">
    3-2 execute:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-upload-to-the-chef-server-and-upload-to-client" class="md-nav__link">
    3-3 Upload to the chef server and upload to client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4install-apache-and-configuration" class="md-nav__link">
    4、Install Apache and Configuration
  </a>
  
    <nav class="md-nav" aria-label="4、Install Apache and Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1-apacherb" class="md-nav__link">
    4-1 apache.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5configure-virtual-hosts" class="md-nav__link">
    5、Configure Virtual Hosts
  </a>
  
    <nav class="md-nav" aria-label="5、Configure Virtual Hosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1-add-attributes" class="md-nav__link">
    5-1 Add attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-attributesdefaultrb" class="md-nav__link">
    5-2 attributes/default.rb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-add-template" class="md-nav__link">
    5-3 Add template
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-4-templatesdefaultvirtualhostserb" class="md-nav__link">
    5-4 templates/default/virtualhosts.erb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6apache-configuration-for-virtual-host" class="md-nav__link">
    6、Apache Configuration for Virtual host
  </a>
  
    <nav class="md-nav" aria-label="6、Apache Configuration for Virtual host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apacherb" class="md-nav__link">
    apache.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7mysql" class="md-nav__link">
    7、MySQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8create-and-encrypt-your-mysql-password" class="md-nav__link">
    8、Create and Encrypt Your MySQL Password
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9set-up-mysql" class="md-nav__link">
    9、Set Up MySQL
  </a>
  
    <nav class="md-nav" aria-label="9、Set Up MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#9-1-mysqlrb" class="md-nav__link">
    9-1 mysql.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10php" class="md-nav__link">
    10、PHP
  </a>
  
    <nav class="md-nav" aria-label="10、PHP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10-1-phprb" class="md-nav__link">
    10-1 php.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learning Ansible
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Learning Ansible
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/1ansible_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L1 Ansible Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/2ansible_over_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L2 Ansible Install(MacOs) and Environment Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/3play_task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L3 Task Execution management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/4Ansible_variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L4 Ansible Variable Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/5Complex_roles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L5 Managing complex playbooks with roles and ansible galaxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/6Secret_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L6 Working with Secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/7Network_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L7 Network Management with Ansible
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/8idempotentence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L8 Idempotentence with Ansible play
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/9Ansible_interview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L9 Ansible Interview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/10Ansible_learn_ppt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L10 Ansible 自动化运维工具PPT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/11Ansible_task1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L11 任务中心之Ansible基础篇
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/12Ansible_task2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L12 任务中心之Ansible进阶篇
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/13Ansible_int/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L13 Ansible 面试知识点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/14Ansible_containerd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L14 Ansible Role批量部署Containerd服务
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    HashiCorp Certified Terraform Associate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            HashiCorp Certified Terraform Associate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/1hashicorp_certified_terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HashiCorp Certified Terraform Associate Learning Path
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/2terraform_cs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/3terraform_lock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    .terraform.lock.hcl 简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/4terraform_var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    terraform.tfvars 与 variables.tf 的区别
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/5terraform_random/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform: Random 简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/6terraform_int/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Top Terraform Interview Questions and Answers (2022)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/7terraform_provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform provider update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/8terraform_docker_jenkins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform install Jenkins in Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/9terraform_local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    解决Terraform初始化慢~配置本地离线源
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/10terraform_adv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform(Troubleshooting/Data Sources/Existing Resource)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/11tf_adv_exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform Exam(Backend/Command/Script/Others)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/12terraform_jenkins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 Adding Terraform to a CI/CD Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/13terraform_cmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform Integrating with Configuration Managers(Anisble)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Puppet Learning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Puppet Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/1pp_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Puppet - Overview & Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/2pp_install_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Puppet - 安装, 配置以及验证
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/3pp_coding_style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Puppet - 编码风格
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/4pp_key_comps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Puppet - 核心模块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/5pp_resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Puppet - 资源
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/6pp_tmp_cls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Puppet - 模板 & 类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/7pp_func/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Puppet - Function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/8pp_env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Puppet - 环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/9app_type_pr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 Puppet - 类型和提供者
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/10pp_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 Puppet - RESTful API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6_pp/11pp_proj1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 Puppet - Live Project 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ArgoCD Learning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            ArgoCD Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7_argocd/1Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Introduction to Continuous Delivery
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1add-new-client-node" class="md-nav__link">
    1、Add new Client Node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2create-the-cookbook-on-workstation" class="md-nav__link">
    2、Create the Cookbook on workstation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3default-recipes" class="md-nav__link">
    3、default recipes
  </a>
  
    <nav class="md-nav" aria-label="3、default recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1-defaultrb" class="md-nav__link">
    3-1 default.rb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-2-execute" class="md-nav__link">
    3-2 execute:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-3-upload-to-the-chef-server-and-upload-to-client" class="md-nav__link">
    3-3 Upload to the chef server and upload to client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4install-apache-and-configuration" class="md-nav__link">
    4、Install Apache and Configuration
  </a>
  
    <nav class="md-nav" aria-label="4、Install Apache and Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1-apacherb" class="md-nav__link">
    4-1 apache.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5configure-virtual-hosts" class="md-nav__link">
    5、Configure Virtual Hosts
  </a>
  
    <nav class="md-nav" aria-label="5、Configure Virtual Hosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-1-add-attributes" class="md-nav__link">
    5-1 Add attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-2-attributesdefaultrb" class="md-nav__link">
    5-2 attributes/default.rb
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-3-add-template" class="md-nav__link">
    5-3 Add template
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-4-templatesdefaultvirtualhostserb" class="md-nav__link">
    5-4 templates/default/virtualhosts.erb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6apache-configuration-for-virtual-host" class="md-nav__link">
    6、Apache Configuration for Virtual host
  </a>
  
    <nav class="md-nav" aria-label="6、Apache Configuration for Virtual host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apacherb" class="md-nav__link">
    apache.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7mysql" class="md-nav__link">
    7、MySQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8create-and-encrypt-your-mysql-password" class="md-nav__link">
    8、Create and Encrypt Your MySQL Password
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9set-up-mysql" class="md-nav__link">
    9、Set Up MySQL
  </a>
  
    <nav class="md-nav" aria-label="9、Set Up MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#9-1-mysqlrb" class="md-nav__link">
    9-1 mysql.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10php" class="md-nav__link">
    10、PHP
  </a>
  
    <nav class="md-nav" aria-label="10、PHP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#10-1-phprb" class="md-nav__link">
    10-1 php.rb
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="creating-lamp-chef-cookbook-analysis"><strong>第二节 Creating LAMP Chef Cookbook Analysis</strong></h1>
<h2 id="1add-new-client-node"><strong>1、Add new Client Node</strong></h2>
<pre><code>knife bootstrap client_ip -x username -P password --sudo --use-sudo-password --node-name node2
</code></pre>
<pre><code>knife client list
</code></pre>
<pre><code>knife client show node_name
</code></pre>
<h2 id="2create-the-cookbook-on-workstation"><strong>2、Create the Cookbook on workstation</strong></h2>
<pre><code>cd chef-repo/cookbooks
chef generate cookbook cookbook_name
</code></pre>
<h2 id="3default-recipes"><strong>3、default recipes</strong></h2>
<h3 id="3-1-defaultrb"><strong>3-1 default.rb</strong></h3>
<pre><code>execute &quot;update-upgrade&quot; do
  command &quot;sudo apt-get update &amp;&amp; sudo apt-get upgrade -y&quot;
  action :run
end
</code></pre>
<h3 id="3-2-execute"><strong>3-2 execute:</strong></h3>
<p>Commands are often run in combination with other Chef resources. </p>
<p>Actions:</p>
<p><code>:nothing</code></p>
<p>Prevent a command from running. This action is used to specify that a command is run <strong><em>only when another resource notifies it</em></strong></p>
<p><code>:run</code></p>
<p>Default. Run a command.</p>
<p><strong>Examples:</strong></p>
<p>Commands are often run in combination with other Chef resources. The following example shows the template resource run with the execute resource to add an entry to a LDAP Directory Interchange Format (LDIF) file:</p>
<pre><code>execute 'slapadd' do
  command 'slapadd &lt; /tmp/something.ldif'
  creates '/var/lib/slapd/uid.bdb'
  action :nothing
end

template '/tmp/something.ldif' do
  source 'something.ldif'
  notifies :run, 'execute[slapadd]', :immediately
end

</code></pre>
<h3 id="3-3-upload-to-the-chef-server-and-upload-to-client"><strong>3-3 Upload to the chef server and upload to client</strong></h3>
<pre><code>sudo knife cookbook upload cookbook_name
knife cookbook lists

knife node run_list add node_name &quot;recipe[cookbook_name]&quot;
</code></pre>
<h2 id="4install-apache-and-configuration"><strong>4、Install Apache and Configuration</strong></h2>
<h3 id="4-1-apacherb"><strong>4-1 apache.rb</strong></h3>
<p>package: <a href="https://docs.chef.io/resource_package.html">https://docs.chef.io/resource_package.html</a></p>
<pre><code>package &quot;apache2&quot; do
  action :install
end

service &quot;apache2&quot; do
  action [:enable, :start]
end
</code></pre>
<p>Add  the new recipe to the chef node</p>
<pre><code>knife node run_list add node2 &quot;recipe[lamp_stack::apache]&quot;
</code></pre>
<p>On the chef node</p>
<pre><code>sudo chef-client
</code></pre>
<h2 id="5configure-virtual-hosts"><strong>5、Configure Virtual Hosts</strong></h2>
<h3 id="5-1-add-attributes"><strong>5-1 Add attributes</strong></h3>
<pre><code>chef generate attribute ~/chef-repo/cookbooks/lamp_stack default
</code></pre>
<h3 id="5-2-attributesdefaultrb"><strong>5-2 attributes/default.rb</strong></h3>
<pre><code>default[&quot;lamp_stack&quot;][&quot;sites&quot;][&quot;example.com&quot;] = { &quot;port&quot; =&gt; 80, &quot;servername&quot; =&gt; &quot;example.com&quot;, &quot;serveradmin&quot; =&gt; &quot;webmaster@example.com&quot; }
default[&quot;lamp_stack&quot;][&quot;sites&quot;][&quot;example.org&quot;] = { &quot;port&quot; =&gt; 80, &quot;servername&quot; =&gt; &quot;example.org&quot;, &quot;serveradmin&quot; =&gt; &quot;webmaster@example.org&quot; }
</code></pre>
<p><strong>loop the attributes</strong></p>
<pre><code>node[&quot;lamp_stack&quot;][&quot;sites&quot;].each do |sitename, data|
end
</code></pre>
<pre><code>sitename =&gt; [&quot;example.com&quot;] [&quot;example.org&quot;]
datat    =&gt; { &quot;port&quot; =&gt; 80, &quot;servername&quot; =&gt; &quot;example.com&quot;, &quot;serveradmin&quot; =&gt; &quot;webmaster@example.com&quot; }
</code></pre>
<pre><code>node[&quot;lamp_stack&quot;][&quot;sites&quot;].each do |sitename, data|

  document_root = &quot;/var/www/html/#{sitename}&quot;

  directory document_root do
    mode &quot;0755&quot;
    recursive true
  end

end 
</code></pre>
<h3 id="5-3-add-template"><strong>5-3 Add template</strong></h3>
<pre><code>chef generate template ~/chef-repo/cookbooks/lamp_stack virtualhosts
</code></pre>
<h3 id="5-4-templatesdefaultvirtualhostserb"><strong>5-4 templates/default/virtualhosts.erb</strong></h3>
<pre><code>&lt;VirtualHost *:&lt;%= @port %&gt;&gt;
        ServerAdmin &lt;%= @serveradmin %&gt;
        ServerName &lt;%= @servername %&gt;
        ServerAlias www.&lt;%= @servername %&gt;
        DocumentRoot &lt;%= @document_root %&gt;/public_html
        ErrorLog &lt;%= @document_root %&gt;/logs/error.log
        &lt;Directory &lt;%= @document_root %&gt;/public_html&gt;
                Require all granted
        &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<pre><code>template &quot;/etc/apache2/sites-available/#{sitename}.conf&quot; do

    source &quot;virtualhosts.erb&quot;
    mode &quot;0644&quot;

    variables(
      :document_root =&gt; document_root,
      :port =&gt; data[&quot;port&quot;],
      :serveradmin =&gt; data[&quot;serveradmin&quot;],
      :servername =&gt; data[&quot;servername&quot;]
    ) 

    notifies :restart, &quot;service[apache2]&quot;

end
</code></pre>
<p>The name of the template resource should be the location where the virtual host file is placed on the nodes. The source is the name of the template file. <code>Mode 0644</code> gives the file owner read and write privileges, and everyone else read privileges. The values defined in the variables section are taken from the attributes file, and they are the same values that are called upon in the template</p>
<h2 id="6apache-configuration-for-virtual-host"><strong>6、Apache Configuration for Virtual host</strong></h2>
<p><strong>configuring a multi-processing module (MPM)</strong></p>
<pre><code>/files/default/mpm_event.conf
</code></pre>
<pre><code>&lt;IfModule mpm_event_module&gt;
        StartServers        2
        MinSpareThreads     6
        MaxSpareThreads     12
        ThreadLimit         64
        ThreadsPerChild     25
        MaxRequestWorkers   25
        MaxConnectionsPerChild  3000
&lt;/IfModule&gt;
</code></pre>
<h3 id="apacherb"><strong>apache.rb</strong></h3>
<pre><code>package &quot;apache2&quot; do
  action :install
end

service &quot;apache2&quot; do
  action [:enable, :start]
end

#Virtual Hosts Files

node[&quot;lamp_stack&quot;][&quot;sites&quot;].each do |sitename, data|
  document_root = &quot;/var/www/html/#{sitename}&quot;

  directory document_root do
    mode &quot;0755&quot;
    recursive true
  end

  execute &quot;enable-sites&quot; do
    command &quot;a2ensite #{sitename}&quot;
    action :nothing
  end

  template &quot;/etc/apache2/sites-available/#{sitename}.conf&quot; do
    source &quot;virtualhosts.erb&quot;
    mode &quot;0644&quot;
    variables(
      :document_root =&gt; document_root,
      :port =&gt; data[&quot;port&quot;],
      :serveradmin =&gt; data[&quot;serveradmin&quot;],
      :servername =&gt; data[&quot;servername&quot;]
    )
    notifies :run, &quot;execute[enable-sites]&quot;
    notifies :restart, &quot;service[apache2]&quot;
  end

  directory &quot;/var/www/html/#{sitename}/public_html&quot; do
    action :create
  end

  directory &quot;/var/www/html/#{sitename}/logs&quot; do
    action :create
  end

  execute &quot;keepalive&quot; do
    command &quot;sed -i 's/KeepAlive On/KeepAlive Off/g' /etc/apache2/apache2.conf&quot;
    action :run
  end

  execute &quot;enable-event&quot; do
    command &quot;a2enmod mpm_event&quot;
    action :nothing
  end

  cookbook_file &quot;/etc/apache2/mods-available/mpm_event.conf&quot; do
    source &quot;mpm_event.conf&quot;
    mode &quot;0644&quot;
    notifies :run, &quot;execute[enable-event]&quot;
  end

end
</code></pre>
<h2 id="7mysql"><strong>7、MySQL</strong></h2>
<pre><code>knife cookbook site install mysql
</code></pre>
<p><strong>add dependency</strong></p>
<pre><code>vi ~/chef-repo/cookbooks/lamp_stack/metadata.rb

depends          'mysql', '~&gt; 8.5.1
</code></pre>
<pre><code>knife cookbook upload mysql --include-dependencies
sudo knife cookbook upload lamp_stack --force
</code></pre>
<h2 id="8create-and-encrypt-your-mysql-password"><strong>8、Create and Encrypt Your MySQL Password</strong></h2>
<p>On the workstation, create a <strong>mysql data bag</strong> that will contain the file <code>rtpass.json</code> for the root password</p>
<pre><code>openssl rand -base64 512 &gt; ~/chef-repo/.chef/encrypted_data_bag_secret
knife data bag create mysql rtpass.json --secret-file ~/chef-repo/.chef/encrypted_data_bag_secret
</code></pre>
<p><strong>vi knife.rb</strong></p>
<pre><code>knife[:editor] = &quot;/usr/bin/vim&quot;
</code></pre>
<p><strong>vi rtpass.json</strong></p>
<pre><code>{
  &quot;id&quot;: &quot;rtpass.json&quot;,
  &quot;password&quot;: &quot;password123&quot;
}
</code></pre>
<pre><code>$ knife data bag show mysql

rtpass.json

$ knife data bag show mysql rtpass.json
</code></pre>
<h2 id="9set-up-mysql"><strong>9、Set Up MySQL</strong></h2>
<h3 id="9-1-mysqlrb"><strong>9-1 mysql.rb</strong></h3>
<pre><code>mysqlpass = data_bag_item(&quot;mysql&quot;, &quot;rtpass.json&quot;)

mysql_service &quot;mysqldefault&quot; do
  version '5.7'
  initial_root_password mysqlpass[&quot;password&quot;]
  action [:create, :start]
end
</code></pre>
<pre><code>sudo knife cookbook upload lamp_stack --force
knife node run_list add node2 &quot;recipe[lamp_stack::mysql]&quot;
</code></pre>
<h2 id="10php"><strong>10、PHP</strong></h2>
<pre><code>vi php.rb

package &quot;php&quot; do
  action :install
end

package &quot;php-pear&quot; do
  action :install
end

package &quot;php-mysql&quot; do
  action :install
end
</code></pre>
<p>The file will be put on node </p>
<p><strong>files/default/php.ini</strong></p>
<pre><code>max_execution_time = 30
memory_limit = 128M
error_reporting = E_COMPILE_ERROR|E_RECOVERABLE_ERROR|E_ERROR|E_CORE_ERROR
display_errors = Off
log_errors = On
error_log = /var/log/php/error.log
max_input_time = 30
</code></pre>
<h3 id="10-1-phprb"><strong>10-1 php.rb</strong></h3>
<pre><code>package &quot;php&quot; do
  action :install
end

package &quot;php-pear&quot; do
  action :install
end

package &quot;php-mysql&quot; do
  action :install
end

cookbook_file &quot;/etc/php/7.0/cli/php.ini&quot; do
  source &quot;php.ini&quot;
  mode &quot;0644&quot;
  notifies :restart, &quot;service[apache2]&quot;
end

execute &quot;chownlog&quot; do
  command &quot;chown www-data /var/log/php&quot;
  action :nothing
end

directory &quot;/var/log/php&quot; do
  action :create
  notifies :run, &quot;execute[chownlog]&quot;
end
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>